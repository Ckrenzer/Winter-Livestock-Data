---
title: "Further Exploration"
author: "Connor Krenzer"
date: "4/20/2021"
output: html_document
---


# Introduction

The other files were getting pretty long, and I want to have a separate location to examine different parts of the data. I am happy with the organization of `La Junta Collection.Rmd`, but `La Junta Modeling.Rmd` and `La Junta Predictions.Rmd` seem like black boxes.

In `La Junta Modeling.Rmd`, I just threw one model or graph after the other until I was happy throwing models at the data. The write-ups were nice, but they were mostly classification models. Classification models aren't all that helpful now that my scraping algorithm misses few values.

My initial goal for `La Junta Predictions.Rmd` was to make a nice overview of the data. It served that purpose well, but the names of the files are getting confusing. I have a better idea of the relevant questions to ask from this dataset, so new (very similar files) might be created in the future to find more pertinent answers.

The classification models helped me get a better grasp of the cattle categories, so now the most important questions should be asked. _How can we effectively predict the price?_

This file, and others in the Experimentation folder, are meant to dive deeper into the data and look for trends.


```{r setup-packages-data, include = FALSE}

knitr::opts_chunk$set(echo = FALSE,
                      results = "hide",
                      error = F,
                      warning = F,
                      message = F)


if(!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, ggplot2, lubridate, readr, shiny, patchwork)


# Reading in the file and removing the URL column
lajunta <- read_csv("https://raw.githubusercontent.com/Ckrenzer/Winter-Livestock-Data/main/La%20Junta%20Market%20Reports.csv",
                    col_types = cols(Date = "D",
                                     Buyer = col_factor(),
                                     Quantity = col_double(),
                                     Type = col_factor(),
                                     Weight = col_double(),
                                     Price = col_double(),
                                     Reprod = col_factor())) %>% 
  dplyr::select(-URL)

```





```{r prices over time}

# This code was taken from 'La Junta Predictions.Rmd'

# Price changes over time
q1 <- lajunta %>%  
  filter(Reprod %in% c("str", "hfr")) %>% 
  group_by(Date) %>% 
  summarize(Price = mean(Price) , Reprod) %>% 
  ggplot() +
  geom_point(mapping = aes(x = Date, y = Price)) +
  geom_line(mapping = aes(x = Date, y = Price)) +
  facet_wrap(~Reprod) +
  ggtitle("Price Changes Over Time") +
  theme_dark()


q2 <-  lajunta %>%  
  filter(Reprod %in% c("bull", "cow")) %>% 
  group_by(Date) %>% 
  summarize(Price = mean(Price), Reprod) %>% 
  ggplot() +
  geom_point(mapping = aes(x = Date, y = Price)) +
  geom_line(mapping = aes(x = Date, y = Price)) +
  facet_wrap(~Reprod) +
  theme_dark()

# using patchwork's "/" operator
q1 / q2

```

```{r Simple moving average}

simple_moving_average <- function(df, reprod_status, variable_name, n){
  weekly_avg <- df %>% 
    filter(Reprod == reprod_status) %>%  
    group_by(Date) %>% 
    summarize("mean_price" = mean({{variable_name}}))
  
  avg <- numeric(nrow(weekly_avg) - n)
  last_date_in_period <- character(nrow(weekly_avg) - n)
  for(i in n:nrow(weekly_avg)){
    avg[(i-n)] <- mean(weekly_avg$mean_price[(i-(n-1)):i])
    last_date_in_period[i-n] <- as.character(weekly_avg$Date[i])
    
  }
  last_date_in_period <- as.Date(last_date_in_period)
  
  sma_results <- data.frame(Date = last_date_in_period, Avg_Price = avg)
  
  return(sma_results)
  
}#end of simple_moving_average()

```







```{r moving average plots}

# steers
simple_moving_average(df = lajunta, reprod_status = "str", variable_name = Price, n = 5) %>% 
  ggplot() +
  geom_line(mapping = aes(x = Date, y = Avg_Price), color = "orange", size = 1) +
  ggtitle("Steer Price SMA for La Junta, CO Sale Barn") +
  xlab("Final Date in Period") +
  ylab("Average Price") +
  theme_minimal()



# heifers
simple_moving_average(df = lajunta, reprod_status = "hfr", variable_name = Price, n = 5) %>% 
  ggplot() +
  geom_line(mapping = aes(x = Date, y = Avg_Price), color = "orange", size = 1) +
  ggtitle("Heifer Price SMA for La Junta, CO Sale Barn") +
  xlab("Final Date in Period") +
  ylab("Average Price") +
  theme_minimal()



# cows
simple_moving_average(df = lajunta, reprod_status = "cow", variable_name = Price, n = 5) %>% 
  ggplot() +
  geom_line(mapping = aes(x = Date, y = Avg_Price), color = "orange", size = 1) +
  ggtitle("Cow Price SMA for La Junta, CO Sale Barn") +
  xlab("Final Date in Period") +
  ylab("Average Price") +
  theme_minimal()



# bulls
simple_moving_average(df = lajunta, reprod_status = "bull", variable_name = Price, n = 5) %>% 
  ggplot() +
  geom_line(mapping = aes(x = Date, y = Avg_Price), color = "orange", size = 1) +
  ggtitle("Bull Price SMA for La Junta, CO Sale Barn") +
  xlab("Final Date in Period") +
  ylab("Average Price") +
  theme_minimal()



```

